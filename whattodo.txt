# NANO BANANA ADMIN PANEL - PROJECT CONTEXT & TRAINING GUIDE

## ğŸ¯ PROJECT OVERVIEW
This is a Next.js 16 admin panel for the Nano Banana application built with TypeScript, Firebase, and Redux Toolkit.

**Tech Stack:**
- Next.js 16.0.7 (App Router)
- React 19.2.0
- TypeScript 5
- Firebase (Firestore)
- Redux Toolkit (State Management)
- Tailwind CSS 4
- Lucide React (Icons)
- JWT Authentication

---

## ğŸ“ CRITICAL FILES TO READ & ANALYZE

### **1. Authentication System**
READ THESE FILES IN ORDER:

1. `lib/types/auth.types.ts` - Authentication type definitions
2. `lib/types/user.types.ts` - User data structure (includes role field)
3. `app/api/auth/login/route.ts` - Server-side login API
4. `app/api/auth/logout/route.ts` - Server-side logout API
5. `app/api/auth/verify/route.ts` - Server-side token verification
6. `lib/services/auth.service.ts` - Client-side auth service
7. `lib/store/authSlice.ts` - Redux auth state management
8. `lib/store/store.ts` - Redux store configuration
9. `lib/hooks/useAuth.ts` - Custom auth hook
10. `components/auth/AuthInitializer.tsx` - App-level auth checker
11. `components/auth/ProtectedRoute.tsx` - Route protection component
12. `app/login/page.tsx` - Login page

**KEY AUTHENTICATION CONCEPTS:**
- JWT-based authentication with 7-day expiry
- Two cookies: `admin_token` (HTTP-only, secure) and `admin_token_client` (readable by JS)
- Only users with `role: 'admin'` can access the panel
- Redux manages auth state globally
- Auth checked ONCE at app level (AuthInitializer) to prevent infinite API calls
- Session persists on page reload via cookie verification

---

### **2. Redux State Management**
READ THESE FILES:

1. `lib/store/store.ts` - Store configuration
2. `lib/store/authSlice.ts` - Auth slice with async thunks
3. `lib/store/hooks.ts` - Typed Redux hooks
4. `lib/store/ReduxProvider.tsx` - Redux provider wrapper
5. `lib/hooks/useAuth.ts` - Auth hook using Redux

**IMPORTANT:**
- We REMOVED Context API and sessionStorage
- Now using Redux Toolkit for state management
- Auth state: { user, isLoading, isAuthenticated, error }
- Async thunks: loginUser, checkAuth, logoutUser

---

### **3. Project Structure**
READ THESE FILES:

1. `app/layout.tsx` - Root layout with ReduxProvider and AuthInitializer
2. `components/AdminLayout.tsx` - Admin panel layout with sidebar
3. `components/Sidebar.tsx` - Navigation sidebar
4. `components/Header.tsx` - Top header with user dropdown
5. `config/icons.ts` - Centralized icon configuration

---

### **4. User Management**
READ THESE FILES:

1. `lib/types/user.types.ts` - User interface with ALL fields
2. `lib/services/user.service.ts` - User CRUD operations
3. `app/users/page.tsx` - Users list page
4. `app/users/view/[id]/page.tsx` - User detail view

**USER FIELDS:**
- id, email, name, photoURL, role, provider, language, createdAt, lastLogin

---

### **5. Feedback System**
READ THESE FILES:

1. `lib/types/feedback.types.ts` - Feedback data structure
2. `lib/services/feedback.service.ts` - Feedback operations
3. `app/feedback/page.tsx` - Feedback list with emoji ratings
4. `app/feedback/view/[id]/page.tsx` - Feedback detail view

**FEEDBACK FEATURES:**
- Emoji ratings: ["ğŸ˜¡", "ğŸ˜•", "ğŸ˜", "ğŸ™‚", "ğŸ¥°"] for ratings 1-5
- Device info displayed in badges (OS, Model, App Version)
- User info populated from userId

---

### **6. Admin User Creation Script**
READ THIS FILE:

1. `scripts/create-admin.js` - Script to create admin users in Firestore

**HOW TO USE:**
```bash
npm run create-admin
```

**ADMIN USERS DEFINED IN SCRIPT:**
- dhvanil@nanobanana.com - Dhvanil Pansuriya
- deep@nanobanana.com - Deep Surti
- hardik@nanobanana.com - Hardik Ramoliya

All have `role: 'admin'` and `provider: 'manual'`

---

### **7. Package Configuration**
READ THIS FILE:

1. `package.json` - All dependencies and scripts

**KEY PACKAGES:**
- @reduxjs/toolkit: ^2.2.1
- react-redux: ^9.1.0
- firebase: ^12.6.0
- jsonwebtoken: ^9.0.2
- js-cookie: ^3.0.5
- bcryptjs: ^2.4.3
- dotenv: ^16.4.5

---

## ğŸ”‘ CRITICAL CONCEPTS TO UNDERSTAND

### **1. Authentication Flow**
```
Login â†’ Server verifies â†’ Generate JWT â†’ Set 2 cookies â†’ Update Redux â†’ Redirect to dashboard
Page Reload â†’ AuthInitializer checks cookie â†’ Verify with API â†’ Update Redux â†’ Stay logged in
```

### **2. Cookie Strategy**
- `admin_token`: HTTP-only (server reads, JS cannot) - SECURE
- `admin_token_client`: Readable by JS (for client-side checks) - CONVENIENCE
- Both contain same JWT token
- Both expire in 7 days

### **3. Redux vs Context API**
- We MIGRATED from Context API to Redux Toolkit
- Reason: Better performance, DevTools, scalability
- Auth state is now in Redux store
- No more sessionStorage usage

### **4. API Routes (Server-side)**
- `/api/auth/login` - POST - Login with email/password
- `/api/auth/logout` - POST - Clear cookies
- `/api/auth/verify` - GET - Verify JWT and return user data

### **5. Role-Based Access**
- User interface has `role` field: 'user' or 'admin'
- Only `role: 'admin'` can access admin panel
- Checked on login and on every verify call

---

## ğŸš¨ KNOWN ISSUES & SOLUTIONS

### **Issue 1: Infinite API Calls**
**Problem:** `/api/auth/verify` called repeatedly
**Solution:** Auth check moved to `AuthInitializer` at app level, called ONCE
**Files:** `components/auth/AuthInitializer.tsx`, `components/auth/ProtectedRoute.tsx`

### **Issue 2: Session Lost on Reload**
**Problem:** User logged out on page refresh
**Solution:** 
- Verify route fetches full user from Firestore (not just JWT decode)
- Returns all user fields including name
**Files:** `app/api/auth/verify/route.ts`

### **Issue 3: JWT in Browser**
**Problem:** `jsonwebtoken` doesn't work in browser
**Solution:** Moved JWT operations to API routes (server-side)
**Files:** All files in `app/api/auth/`

---

## ğŸ“‹ DEVELOPMENT WORKFLOW

### **1. Install Dependencies**
```bash
npm install
```

### **2. Environment Variables**
Create `.env.local` with:
```
NEXT_PUBLIC_FIREBASE_API_KEY=your_key
NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN=your_domain
NEXT_PUBLIC_FIREBASE_PROJECT_ID=your_project
NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET=your_bucket
NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID=your_sender_id
NEXT_PUBLIC_FIREBASE_APP_ID=your_app_id
NEXT_PUBLIC_JWT_SECRET=your_secret_key
```

### **3. Create Admin Users**
```bash
npm run create-admin
```

### **4. Run Development Server**
```bash
npm run dev
```

### **5. Login**
- Go to http://localhost:3000/login
- Use any admin email from script
- Password: any (temporary - not verified yet)

---

## ğŸ¨ UI/UX PATTERNS

### **Header Component**
- User avatar (or gradient placeholder with initial)
- Dropdown with user info and logout
- ChevronDown icon (rotates 180Â° when open)
- Width: w-72 for dropdown
- NO gradients (solid colors only)

### **Feedback Page**
- Emoji ratings instead of stars
- Device info in inline badges
- User name and email populated from userId
- View button for detailed feedback

### **User Page**
- Role badge (admin = secondary color, user = accent color)
- All user fields displayed
- View/Edit/Delete actions

---

## ğŸ”§ CODING STANDARDS

### **1. File Naming**
- Components: PascalCase (e.g., `AdminLayout.tsx`)
- Utilities: camelCase (e.g., `auth.service.ts`)
- Types: camelCase with .types.ts (e.g., `user.types.ts`)

### **2. Import Order**
1. React/Next imports
2. Third-party libraries
3. Local components
4. Services/Utils
5. Types
6. Styles

### **3. TypeScript**
- Always use interfaces for data structures
- Use `type` for unions/intersections
- Avoid `any` (use `unknown` or proper types)

### **4. Redux Patterns**
- Use `createAsyncThunk` for API calls
- Use `createSlice` for state management
- Use typed hooks: `useAppDispatch`, `useAppSelector`

### **5. API Routes**
- Always use try-catch
- Return proper HTTP status codes
- Use NextResponse.json()
- Validate input data

---

## ğŸ“ IMPORTANT NOTES FOR NEW SESSION

### **DO:**
âœ… Read all files mentioned above before making changes
âœ… Understand Redux state management (we use Redux, NOT Context API)
âœ… Know that auth is checked ONCE at app level
âœ… Remember two cookies exist for security + convenience
âœ… Use typed Redux hooks (useAppDispatch, useAppSelector)
âœ… Check user.role === 'admin' for access control
âœ… Return all user fields in API responses (not just id, email, role)

### **DON'T:**
âŒ Create Context API (we use Redux)
âŒ Use sessionStorage (we use Redux + cookies)
âŒ Call checkAuth() in multiple places (only in AuthInitializer)
âŒ Use JWT in client-side code (only in API routes)
âŒ Create summary/guide files (user doesn't want them)
âŒ Use gradients in UI (user preference: solid colors)
âŒ Forget to include all user fields in AuthUser interface

---

## ğŸ—‚ï¸ FILE STRUCTURE OVERVIEW

```
nano-banana-admin-panel/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/auth/          # Server-side auth routes
â”‚   â”œâ”€â”€ login/             # Login page
â”‚   â”œâ”€â”€ users/             # User management
â”‚   â”œâ”€â”€ feedback/          # Feedback management
â”‚   â”œâ”€â”€ categories/        # Categories
â”‚   â”œâ”€â”€ countries/         # Countries
â”‚   â”œâ”€â”€ prompts/           # Prompts
â”‚   â”œâ”€â”€ subscription-plan/ # Subscription plans
â”‚   â”œâ”€â”€ user-subscription/ # User subscriptions
â”‚   â”œâ”€â”€ app-settings/      # App settings
â”‚   â”œâ”€â”€ developer-guide/   # Developer guide
â”‚   â””â”€â”€ layout.tsx         # Root layout
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ auth/              # Auth components
â”‚   â”œâ”€â”€ AdminLayout.tsx    # Main layout
â”‚   â”œâ”€â”€ Sidebar.tsx        # Navigation
â”‚   â””â”€â”€ Header.tsx         # Top header
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ store/             # Redux store
â”‚   â”œâ”€â”€ hooks/             # Custom hooks
â”‚   â”œâ”€â”€ services/          # API services
â”‚   â”œâ”€â”€ types/             # TypeScript types
â”‚   â””â”€â”€ contexts/          # (DEPRECATED - we use Redux now)
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ firebase.ts        # Firebase config
â”‚   â””â”€â”€ icons.ts           # Icon exports
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ create-admin.js    # Admin creation script
â””â”€â”€ package.json           # Dependencies
```

---

## ğŸ“ TRAINING INSTRUCTIONS FOR NEW SESSION

**Step 1:** Read this entire file carefully

**Step 2:** Read these files in order:
1. `package.json` - Understand dependencies
2. `lib/types/user.types.ts` - User data structure
3. `lib/types/auth.types.ts` - Auth data structure
4. `lib/store/authSlice.ts` - Redux auth logic
5. `app/api/auth/login/route.ts` - Login logic
6. `app/api/auth/verify/route.ts` - Verification logic
7. `components/auth/AuthInitializer.tsx` - Auth initialization
8. `app/layout.tsx` - App structure

**Step 3:** Understand these concepts:
- Redux Toolkit state management
- JWT authentication with two cookies
- Role-based access control
- Server-side API routes vs client-side code

**Step 4:** Remember these rules:
- No Context API (use Redux)
- No sessionStorage (use Redux + cookies)
- Auth checked once at app level
- All user fields in AuthUser interface
- No gradients in UI
- No summary files

**Step 5:** You're ready to help!

---

## ğŸ†˜ QUICK REFERENCE

### **Add New Admin User**
Edit `scripts/create-admin.js` â†’ Add to ADMIN_USERS array â†’ Run `npm run create-admin`

### **Check Auth State**
Redux DevTools â†’ State â†’ auth â†’ { user, isLoading, isAuthenticated, error }

### **Debug Auth Issues**
1. Check cookies in browser DevTools
2. Check Redux state
3. Check `/api/auth/verify` response
4. Check Firestore user document has `role: 'admin'`

### **Common Commands**
```bash
npm install              # Install dependencies
npm run dev             # Start dev server
npm run create-admin    # Create admin users
npm run build           # Build for production
```

---

## ğŸ“ PROJECT CONTACTS

**Admin Users:**
- Dhvanil Pansuriya - dhvanil@nanobanana.com
- Deep Surti - deep@nanobanana.com
- Hardik Ramoliya - hardik@nanobanana.com

---

## âœ… VERIFICATION CHECKLIST

Before helping with this project, verify you understand:

- [ ] Redux Toolkit is used (NOT Context API)
- [ ] Two cookies exist: admin_token (HTTP-only) and admin_token_client (readable)
- [ ] Auth checked once in AuthInitializer component
- [ ] Only role: 'admin' users can access panel
- [ ] AuthUser interface has ALL user fields
- [ ] JWT operations only in API routes (server-side)
- [ ] No sessionStorage usage
- [ ] No gradient backgrounds in UI
- [ ] Feedback uses emoji ratings
- [ ] User data populated from Firestore

---

## ğŸ¯ CURRENT STATE OF PROJECT

**Authentication:** âœ… Fully implemented with Redux + JWT
**User Management:** âœ… CRUD operations complete
**Feedback System:** âœ… List and detail views with emojis
**Admin Creation:** âœ… Script ready with 3 admins
**State Management:** âœ… Redux Toolkit configured
**Session Persistence:** âœ… Works on page reload
**API Routes:** âœ… Login, logout, verify implemented
**Protected Routes:** âœ… Only admins can access

**Status:** Production-ready admin panel with secure authentication

---

## ğŸš€ NEXT STEPS (If User Asks)

Potential improvements:
1. Add password hashing and verification (currently accepts any password)
2. Add "Remember Me" functionality
3. Add 2FA (Two-Factor Authentication)
4. Add password reset flow
5. Add user profile editing
6. Add audit logs
7. Add more Redux slices for other entities
8. Add Redux Persist for offline support

---

**END OF TRAINING GUIDE**

This file contains everything needed to train a new AI session to have the same context and understanding as the current session. Read all mentioned files and understand the concepts above.
